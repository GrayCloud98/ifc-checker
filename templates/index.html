<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>IFC Modellprüfung</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { orbitron: ['Orbitron', 'sans-serif'] }
        }
      }
    }
  </script>
  <style>
    .spin { animation: spin 0.8s linear forwards; }
    .spin-reverse { animation: spin-reverse 0.8s linear forwards; }
    @keyframes spin { from { transform: rotate(0) } to { transform: rotate(360deg) } }
    @keyframes spin-reverse { from { transform: rotate(360deg) } to { transform: rotate(0) } }
  </style>
</head>
<body class="bg-gradient-to-br from-zinc-900 via-zinc-800 to-zinc-900 text-white min-h-screen font-orbitron">

<!-- Navbar -->
<header class="backdrop-blur-md bg-zinc-900/70 border-b border-zinc-800 px-8 py-4 flex justify-between items-center shadow-md relative z-50">
  <h1 class="text-2xl font-semibold tracking-widest text-white drop-shadow pl-4">IFC MODELLPRÜFUNG</h1>

  {% if not session.admin %}
  <div class="flex items-center space-x-4">
    <!-- Icon -->
    <button id="loginToggle"
            onclick="toggleLogin()"
            class="text-zinc-400 hover:text-white transition-transform duration-300 ease-in-out">
      <svg xmlns="http://www.w3.org/2000/svg" id="loginIcon"
           class="h-7 w-7 transition-transform duration-500"
           fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M5.121 17.804A4.992 4.992 0 0012 20a4.992 4.992 0 006.879-2.196M15 10a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    </button>

    <!-- Login fields -->
    <form method="POST" action="/admin" id="loginForm"
          class="flex items-center space-x-2 transition-all origin-top transform scale-y-0 opacity-0 overflow-hidden">
      <input type="text" name="username" placeholder="Benutzername"
             class="px-3 py-1 rounded bg-zinc-800 border border-zinc-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-36" required>
      <input type="password" name="password" placeholder="Passwort"
             class="px-3 py-1 rounded bg-zinc-800 border border-zinc-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm w-36" required>
      <button type="submit"
              class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 px-3 py-1 rounded text-sm font-semibold shadow">
        Login
      </button>
    </form>
  </div>
  {% else %}
  <div class="space-x-4 text-sm text-zinc-300">
    <a href="/admin" class="hover:text-blue-400">Adminbereich</a>
  </div>
  {% endif %}
</header>

<script>
  let loginVisible = false;
  function toggleLogin() {
    const form = document.getElementById('loginForm');
    const icon = document.getElementById('loginIcon');

    if (!loginVisible) {
      form.classList.remove('scale-y-0', 'opacity-0');
      form.classList.add('scale-y-100', 'opacity-100');
      icon.classList.remove('spin-reverse');
      icon.classList.add('spin');
    } else {
      form.classList.add('scale-y-0', 'opacity-0');
      form.classList.remove('scale-y-100', 'opacity-100');
      icon.classList.remove('spin');
      icon.classList.add('spin-reverse');
    }
    loginVisible = !loginVisible;
  }
</script>

<!-- Main -->
<main class="max-w-5xl mx-auto py-12 px-6 space-y-10">
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="space-y-2">
        {% for msg in messages %}
          <div class="bg-blue-600/80 backdrop-blur-sm text-white px-4 py-2 rounded shadow">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Upload -->
  <section class="bg-zinc-900/80 border border-zinc-700 p-10 rounded-xl shadow-2xl backdrop-blur-sm ring-1 ring-zinc-700/40">
    <h2 class="text-2xl font-bold mb-6">IFC-Datei hochladen</h2>
    <form method="POST" action="/upload" enctype="multipart/form-data" class="space-y-6">
      <input type="file" name="file" accept=".ifc"
             class="block w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm text-gray-200 file:bg-zinc-700 file:border-0 file:py-2 file:px-4 file:text-sm file:text-white file:font-semibold file:cursor-pointer"
             required />
      <button type="submit"
              class="w-full bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 text-white px-6 py-3 rounded-md text-lg font-semibold tracking-wide hover:from-blue-600 hover:to-purple-700 transition shadow-xl">
        Hochladen & Prüfen
      </button>
    </form>
  </section>

  {% if standards %}
  <section class="bg-zinc-800/50 p-6 rounded border border-zinc-700 shadow text-sm">
    <h3 class="font-semibold mb-2">Aktuelle Standards</h3>
    <ul class="space-y-1 text-gray-300">
      <li>Breite ≥ {{ standards.get('Breite (m)') or '—' }} m</li>
      <li>Länge ≥ {{ standards.get('Länge (m)') or '—' }} m</li>
      <li>Neigung ≤ {{ standards.get('Neigung (%)') or '—' }} %</li>
    </ul>
  </section>
  {% endif %}

  {% if results %}
  <section class="mt-4">
    <h2 class="text-xl font-bold mb-4">Prüfergebnisse</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full border-collapse text-sm text-left">
        <thead>
          <tr class="bg-zinc-700 text-gray-300">
            <th class="px-4 py-2 border border-zinc-600">Element</th>
            {% for col in columns %}
              <th class="px-4 py-2 border border-zinc-600">{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in results %}
            <tr class="hover:bg-zinc-800">
              <!-- Short name with tooltip showing full IFC name -->
              <td class="px-4 py-2 border border-zinc-700" title="{{ row.Name }}">{{ row.Short }}</td>

              {% for col in columns %}
                {% set val = row.Values.get(col) %}
                {% set cell = "-" if val is none else val %}

                {# ramp-only traffic-light coloring #}
                {% set cls = '' %}
                {% if row.Short == 'Rampe' and col == 'Breite (m)' %}
                  {% set cls = 'bg-green-600/40' if row.get('Breite_ok') else 'bg-red-600/40' %}
                {% elif row.Short == 'Rampe' and col == 'Länge (m)' %}
                  {% set cls = 'bg-green-600/40' if row.get('Länge_ok') else 'bg-red-600/40' %}
                {% elif row.Short == 'Rampe' and col == 'Neigung (%)' %}
                  {% set cls = 'bg-green-600/40' if row.get('Neigung_ok') else 'bg-red-600/40' %}
                {% endif %}

                <td class="px-4 py-2 border border-zinc-700 {{ cls }}">{{ cell }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  {% endif %}
</main>
</body>
</html>
